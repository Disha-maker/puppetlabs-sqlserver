BEGIN
    USE [<%= @database %>];
    <% if @with_grant_option == false %>
    IF 'GRANT_WITH_GRANT_OPTION' = <%= scope.function_template(['sqlserver/snippets/user/permission/get_perm_state.sql.erb']) %>
        REVOKE GRANT OPTION FOR <%= @_permission %> TO [<%= @user %>] CASCADE;
    <% end %>
    <%= @_state %> <%= @_permission %> TO [<%= @user %>]<% if @with_grant_option == true %> WITH GRANT OPTION<% end %>;
END
BEGIN
    <%= scope.function_template(['sqlserver/query/user/permission_exists.sql.erb']) %>
END
